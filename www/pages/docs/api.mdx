import { I18nText } from '../../components/site/I18nProvider'

# <I18nText en="API Reference" zh="API 参考" />

<I18nText
  en="`HybricEditor` is the main integration component for app-level editing surfaces."
  zh="`HybricEditor` 是应用侧编辑界面的核心集成组件。"
/>

## <I18nText en="`<HybricEditor />` Props" zh="`<HybricEditor />` 属性" />

| <I18nText en="Prop" zh="属性" /> | <I18nText en="Type" zh="类型" /> | <I18nText en="Default" zh="默认值" /> | <I18nText en="Description" zh="说明" /> |
| --- | --- | --- | --- |
| `content` | `string \| JSONContent` | `undefined` | <I18nText en="Initial content input. Accepts Markdown, HTML, or Tiptap JSON." zh="初始内容输入，支持 Markdown、HTML 或 Tiptap JSON。" /> |
| `editable` | `boolean` | `true` | <I18nText en="Editable/read-only toggle." zh="编辑/只读切换。" /> |
| `placeholder` | `string` | `"Type '/' for commands..."` | <I18nText en="Placeholder shown for empty document." zh="空文档占位提示文本。" /> |
| `className` | `string` | `undefined` | <I18nText en="Class name applied to editor root container." zh="挂载到编辑器根容器的类名。" /> |
| `extensions` | `Extension[]` | `[]` | <I18nText en="Additional Tiptap extensions merged with default stack." zh="与默认扩展栈合并的自定义扩展。" /> |
| `editorProps` | `EditorProps` | `undefined` | <I18nText en="Native ProseMirror handlers (`handleKeyDown`, `handlePaste`, `handleDrop`, ...)." zh="原生 ProseMirror 处理器（`handleKeyDown`、`handlePaste`、`handleDrop` 等）。" /> |
| `onChange` | `(editor: Editor) => void` | `undefined` | <I18nText en="High-frequency callback on each document update." zh="高频文档更新回调。" /> |
| `onUpdate` | `({ editor, transaction }) => void` | `undefined` | <I18nText en="Transaction-level callback for advanced integration." zh="事务级回调，适合高级集成。" /> |
| `onDebouncedUpdate` | `({ editor, transaction }) => void` | `undefined` | <I18nText en="Debounced callback for persistence. Use this for DB/network writes." zh="防抖回调，建议用于数据库/网络写入。" /> |
| `debounceMs` | `number` | `400` | <I18nText en="Debounce duration for `onDebouncedUpdate`." zh="`onDebouncedUpdate` 的防抖时间（毫秒）。" /> |
| `onExtract` | `(data: { id: string; content: JSON; text: string }) => void` | `undefined` | <I18nText en="Triggered by context menu extract action." zh="由右键菜单摘录动作触发。" /> |

> <I18nText en="Pro tip: keep the editor uncontrolled while typing. Do not force-write `content` from parent state on every keypress, especially with Chinese IME." zh="提示：输入过程中保持编辑器非受控。不要在每次按键时从父状态强制回写 `content`，尤其是中文输入法场景。" />

## <I18nText en="Callback signatures" zh="回调签名" />

```ts
onChange?: (editor: Editor) => void
onUpdate?: (payload: { editor: Editor; transaction: Transaction }) => void
onDebouncedUpdate?: (payload: { editor: Editor; transaction: Transaction }) => void
onExtract?: (data: { id: string; content: JSONContent; text: string }) => void
```

## <I18nText en="Outline / Contents Integration Contract" zh="大纲 / Contents 集成约定" />

<I18nText
  en="HybricMark does not force a fixed outline UI. Build outline in app layer via update hooks to keep typing performance stable."
  zh="HybricMark 不强制内置固定大纲 UI。建议在应用层基于更新回调构建大纲，以保持输入性能稳定。"
/>

```ts
type OutlineItem = {
  id: string
  level: 1 | 2 | 3 | 4 | 5 | 6
  text: string
  blockId?: string
}
```

<I18nText
  en="Recommended trigger points for recomputing outline:"
  zh="推荐的大纲重算触发点："
/>

- <I18nText en="Enter/new line commits." zh="Enter 换行提交后。" />
- <I18nText en="Heading line blur / cursor leaves heading." zh="标题行失焦或光标离开标题行后。" />
- <I18nText en="Paste/delete that changes heading structure." zh="粘贴/删除导致标题结构变化时。" />
- <I18nText en="Debounced idle update (`onDebouncedUpdate`)." zh="防抖空闲更新（`onDebouncedUpdate`）。" />

<I18nText
  en="Use heading `attrs.id` (when present) as stable anchor key; fallback to document position for navigation."
  zh="优先使用标题节点 `attrs.id` 作为稳定锚点键；缺失时再回退到文档位置。"
/>

## <I18nText en="Editor instance methods" zh="编辑器实例方法" />

```ts
editor.chain().focus().toggleBold().run()
editor.chain().focus().setLink({ href: 'https://example.com' }).run()
editor.chain().focus().insertTable({ rows: 3, cols: 3, withHeaderRow: true }).run()

editor.getJSON()
editor.getHTML()
editor.commands.clearContent()
editor.commands.focus()
```

## <I18nText en="Document model (block IDs)" zh="文档模型（块级 ID）" />

```json
{
  "type": "doc",
  "content": [
    {
      "type": "heading",
      "attrs": { "id": "b1a2-3c4d", "level": 1 },
      "content": [{ "type": "text", "text": "Hello World" }]
    },
    {
      "type": "paragraph",
      "attrs": { "id": "uuid-1234" },
      "content": [{ "type": "text", "text": "This block can be referenced directly." }]
    }
  ]
}
```

> <I18nText en="Why this matters: block IDs enable granular patch updates, stable comment anchors, and deterministic card extraction." zh="价值点：块级 ID 支持精细 patch 更新、稳定评论锚点和可追踪摘录流程。" />

## <I18nText en="Default extension surface (runtime)" zh="默认运行时扩展能力" />

- <I18nText en="StarterKit + Link + Underline + Highlight + Sub/Sup." zh="StarterKit + Link + Underline + Highlight + 上下标。" />
- <I18nText en="Task list, image, table, and mathematics support." zh="任务列表、图片、表格、数学公式支持。" />
- <I18nText en="Unique block IDs (`@tiptap/extension-unique-id`)." zh="块级唯一 ID（`@tiptap/extension-unique-id`）。" />
- <I18nText en="Markdown-aware paste parser with footnote/task-list support." zh="带注脚/任务列表的 Markdown 粘贴解析。" />
- <I18nText en="Footnote interaction layer (reference + back reference)." zh="注脚引用与回跳交互层。" />

<I18nText en="See full details on the Extensions page." zh="完整扩展细节请查看扩展列表页。" /> [<I18nText en="Extensions" zh="扩展列表" />](/docs/extensions)

## <I18nText en="Security notes" zh="安全说明" />

- <I18nText en="Client-side sanitization exists for HTML input, but backend sanitization is still mandatory." zh="前端对 HTML 输入有基础净化，但后端净化仍是必须项。" />
- <I18nText en="Validate and whitelist URLs before persistence/rendering." zh="持久化与渲染前要做 URL 白名单校验。" />

## <I18nText en="Quick integration example" zh="快速集成示例" />

```tsx
import { HybricEditor } from 'hybricmark'

export default function EditorPage() {
  return (
    <HybricEditor
      content="# Hello"
      debounceMs={800}
      onDebouncedUpdate={({ editor }) => {
        void fetch('/api/docs/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(editor.getJSON()),
        })
      }}
    />
  )
}
```

## <I18nText en="Outline navigation helper contract" zh="大纲跳转辅助约定" />

```ts
type OutlineNavigation = {
  scrollToHeading: (item: OutlineItem) => void
  setActiveHeadingId: (id: string | null) => void
}
```

<I18nText
  en="Keep navigation/highlight behavior in app layer. HybricMark only provides stable heading data (`attrs.id`) and update hooks."
  zh="跳转与高亮行为建议保留在应用层，HybricMark 提供稳定标题数据（`attrs.id`）与更新钩子。"
/>
